generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model NguoiDung {
  id            Int        @id @default(autoincrement())
  ho_ten        String
  email         String     @unique
  mat_khau      String
  so_dien_thoai String?
  vai_tro       String     @default("khach_hang")
  dia_chi       String?
  avatar_url    String?
  created_at    DateTime   @default(now())
  updated_at    DateTime   @updatedAt
  blogs         Blog[]
  bookings      Booking[]
  thong_baos    ThongBao[]
  tokens        Token[]
}

model Token {
  id            Int       @id @default(autoincrement())
  nguoi_dung_id Int
  token         String
  loai_token    String    @default("access_token")
  het_han       DateTime
  created_at    DateTime  @default(now())
  nguoi_dung    NguoiDung @relation(fields: [nguoi_dung_id], references: [id], onDelete: Cascade)
}

model ThongBao {
  id            Int        @id @default(autoincrement())
  nguoi_dung_id Int?
  booking_id    Int?
  tieu_de       String
  noi_dung      String
  loai          String     @default("thong_bao")
  da_doc        Boolean    @default(false)
  created_at    DateTime   @default(now())
  booking       Booking?   @relation(fields: [booking_id], references: [id], onDelete: Cascade)
  nguoi_dung    NguoiDung? @relation(fields: [nguoi_dung_id], references: [id], onDelete: Cascade)
}

model Tour {
  id             Int         @id @default(autoincrement())
  ten_tour       String
  mo_ta          String?
  mo_ta_ngan     String?
  gia_nguoi_lon  Float
  gia_tre_em     Float?
  so_ngay        Int
  so_dem         Int
  diem_khoi_hanh String
  diem_den       String
  phuong_tien    String
  khach_san      String?
  lich_trinh     Json?
  bao_gom        String[]
  khong_bao_gom  String[]
  dieu_kien      String?
  trang_thai     String      @default("dang_ban")
  so_cho_trong   Int         @default(0)
  so_cho_toi_da  Int
  hinh_anh_chinh String?
  created_at     DateTime    @default(now())
  updated_at     DateTime    @updatedAt
  bookings       Booking[]
  images         TourImage[]
}

model TourImage {
  id         Int      @id @default(autoincrement())
  tour_id    Int
  url        String
  alt_text   String?
  thu_tu     Int      @default(0)
  created_at DateTime @default(now())
  tour       Tour     @relation(fields: [tour_id], references: [id], onDelete: Cascade)
}

model Booking {
  id             Int        @id @default(autoincrement())
  tour_id        Int
  nguoi_dung_id  Int?
  ho_ten         String
  email          String
  so_dien_thoai  String
  dia_chi        String?
  so_nguoi_lon   Int        @default(1)
  so_tre_em      Int        @default(0)
  ngay_khoi_hanh DateTime
  ghi_chu        String?
  tong_tien      Float
  trang_thai     String     @default("cho_xac_nhan")
  created_at     DateTime   @default(now())
  updated_at     DateTime   @updatedAt
  nguoi_dung     NguoiDung? @relation(fields: [nguoi_dung_id], references: [id])
  tour           Tour       @relation(fields: [tour_id], references: [id])
  thong_baos     ThongBao[]
}

model Blog {
  id         Int        @id @default(autoincrement())
  tieu_de    String
  slug       String     @unique
  mo_ta_ngan String?
  noi_dung   String
  hinh_anh   String?
  tac_gia_id Int?
  danh_muc   String?
  tags       String[]
  luot_xem   Int        @default(0)
  trang_thai String     @default("draft")
  ngay_dang  DateTime?
  created_at DateTime   @default(now())
  updated_at DateTime   @updatedAt
  tac_gia    NguoiDung? @relation(fields: [tac_gia_id], references: [id])
}
